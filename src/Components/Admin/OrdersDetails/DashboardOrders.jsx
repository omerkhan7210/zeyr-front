import React,{ useContext, useEffect, useState } from 'react'
import ToggleSwitchButton from '../ToggleSwitchButton'
import { AdminContextC } from '../../Context/AdminContext'
import { OrderRows } from './OrdersRow';
import { OrdersFilter } from './OrdersFilter';

export const DashboardOrders = () => {

  const {orders,fetchOrder} = useContext(AdminContextC);
  const [searchQuery, setSearchQuery] = useState('');
  const [searchCatQuery, setSearchCatQuery] = useState('');
  const [filterOptions, setFilterOptions] = useState({
    paymentStatus: '', // Add more filter options as needed
    orderStatus: '',
    startDate: '',
    endDate: '',
    amountRange: '',
  });
  const [maxprice,setMaxPrice] = useState(0)
  const [minprice,setMinPrice] = useState(0)

  const handleSearchChange = (event) => {
    setSearchQuery(event.target.value);
  };
  
  const handleFilterCategoryChange = (event) => {
    setSearchCatQuery(event.target.value);
  };
  
  const handleFilter = (newFilterOptions) => {
    setFilterOptions(newFilterOptions);
    setMinPrice(filterOptions.amountRange[0])
    setMaxPrice(filterOptions.amountRange[1])
  };
  useEffect(()=>{
    fetchOrder()
  },[orders])

  return (
    <div className="app-content ">
    <div className="app-content-header">
      <h1 className="app-content-headerText">Orders</h1>
      <ToggleSwitchButton/>
    </div>
    <OrdersFilter 
    handleSearchChange={handleSearchChange} 
   searchQuery={searchQuery} 
   handleFilterCategoryChange={handleFilterCategoryChange}
   handleFilter={handleFilter}
   />
    {orders ?
      orders.length > 0 ? (
        <div className="tableView products-area-wrapper ">
      <div className="products-header">
       
        <div className="product-cell category">Order ID<button className="sort-button">
            <svg xmlns="http://www.w3.org/2000/svg" width={16} height={16} viewBox="0 0 512 512"><path fill="currentColor" d="M496.1 138.3L375.7 17.9c-7.9-7.9-20.6-7.9-28.5 0L226.9 138.3c-7.9 7.9-7.9 20.6 0 28.5 7.9 7.9 20.6 7.9 28.5 0l85.7-85.7v352.8c0 11.3 9.1 20.4 20.4 20.4 11.3 0 20.4-9.1 20.4-20.4V81.1l85.7 85.7c7.9 7.9 20.6 7.9 28.5 0 7.9-7.8 7.9-20.6 0-28.5zM287.1 347.2c-7.9-7.9-20.6-7.9-28.5 0l-85.7 85.7V80.1c0-11.3-9.1-20.4-20.4-20.4-11.3 0-20.4 9.1-20.4 20.4v352.8l-85.7-85.7c-7.9-7.9-20.6-7.9-28.5 0-7.9 7.9-7.9 20.6 0 28.5l120.4 120.4c7.9 7.9 20.6 7.9 28.5 0l120.4-120.4c7.8-7.9 7.8-20.7-.1-28.5z" /></svg>
          </button></div>
        <div className="product-cell status-cell">Order Status<button className="sort-button">
            <svg xmlns="http://www.w3.org/2000/svg" width={16} height={16} viewBox="0 0 512 512"><path fill="currentColor" d="M496.1 138.3L375.7 17.9c-7.9-7.9-20.6-7.9-28.5 0L226.9 138.3c-7.9 7.9-7.9 20.6 0 28.5 7.9 7.9 20.6 7.9 28.5 0l85.7-85.7v352.8c0 11.3 9.1 20.4 20.4 20.4 11.3 0 20.4-9.1 20.4-20.4V81.1l85.7 85.7c7.9 7.9 20.6 7.9 28.5 0 7.9-7.8 7.9-20.6 0-28.5zM287.1 347.2c-7.9-7.9-20.6-7.9-28.5 0l-85.7 85.7V80.1c0-11.3-9.1-20.4-20.4-20.4-11.3 0-20.4 9.1-20.4 20.4v352.8l-85.7-85.7c-7.9-7.9-20.6-7.9-28.5 0-7.9 7.9-7.9 20.6 0 28.5l120.4 120.4c7.9 7.9 20.6 7.9 28.5 0l120.4-120.4c7.8-7.9 7.8-20.7-.1-28.5z" /></svg>
          </button></div>
        <div className="product-cell sales">Payment Status<button className="sort-button">
            <svg xmlns="http://www.w3.org/2000/svg" width={16} height={16} viewBox="0 0 512 512"><path fill="currentColor" d="M496.1 138.3L375.7 17.9c-7.9-7.9-20.6-7.9-28.5 0L226.9 138.3c-7.9 7.9-7.9 20.6 0 28.5 7.9 7.9 20.6 7.9 28.5 0l85.7-85.7v352.8c0 11.3 9.1 20.4 20.4 20.4 11.3 0 20.4-9.1 20.4-20.4V81.1l85.7 85.7c7.9 7.9 20.6 7.9 28.5 0 7.9-7.8 7.9-20.6 0-28.5zM287.1 347.2c-7.9-7.9-20.6-7.9-28.5 0l-85.7 85.7V80.1c0-11.3-9.1-20.4-20.4-20.4-11.3 0-20.4 9.1-20.4 20.4v352.8l-85.7-85.7c-7.9-7.9-20.6-7.9-28.5 0-7.9 7.9-7.9 20.6 0 28.5l120.4 120.4c7.9 7.9 20.6 7.9 28.5 0l120.4-120.4c7.8-7.9 7.8-20.7-.1-28.5z" /></svg>
          </button></div>
        <div className="product-cell stock">Order Date<button className="sort-button">
            <svg xmlns="http://www.w3.org/2000/svg" width={16} height={16} viewBox="0 0 512 512"><path fill="currentColor" d="M496.1 138.3L375.7 17.9c-7.9-7.9-20.6-7.9-28.5 0L226.9 138.3c-7.9 7.9-7.9 20.6 0 28.5 7.9 7.9 20.6 7.9 28.5 0l85.7-85.7v352.8c0 11.3 9.1 20.4 20.4 20.4 11.3 0 20.4-9.1 20.4-20.4V81.1l85.7 85.7c7.9 7.9 20.6 7.9 28.5 0 7.9-7.8 7.9-20.6 0-28.5zM287.1 347.2c-7.9-7.9-20.6-7.9-28.5 0l-85.7 85.7V80.1c0-11.3-9.1-20.4-20.4-20.4-11.3 0-20.4 9.1-20.4 20.4v352.8l-85.7-85.7c-7.9-7.9-20.6-7.9-28.5 0-7.9 7.9-7.9 20.6 0 28.5l120.4 120.4c7.9 7.9 20.6 7.9 28.5 0l120.4-120.4c7.8-7.9 7.8-20.7-.1-28.5z" /></svg>
          </button></div>
        <div className="product-cell price">Order Amount<button className="sort-button">
            <svg xmlns="http://www.w3.org/2000/svg" width={16} height={16} viewBox="0 0 512 512"><path fill="currentColor" d="M496.1 138.3L375.7 17.9c-7.9-7.9-20.6-7.9-28.5 0L226.9 138.3c-7.9 7.9-7.9 20.6 0 28.5 7.9 7.9 20.6 7.9 28.5 0l85.7-85.7v352.8c0 11.3 9.1 20.4 20.4 20.4 11.3 0 20.4-9.1 20.4-20.4V81.1l85.7 85.7c7.9 7.9 20.6 7.9 28.5 0 7.9-7.8 7.9-20.6 0-28.5zM287.1 347.2c-7.9-7.9-20.6-7.9-28.5 0l-85.7 85.7V80.1c0-11.3-9.1-20.4-20.4-20.4-11.3 0-20.4 9.1-20.4 20.4v352.8l-85.7-85.7c-7.9-7.9-20.6-7.9-28.5 0-7.9 7.9-7.9 20.6 0 28.5l120.4 120.4c7.9 7.9 20.6 7.9 28.5 0l120.4-120.4c7.8-7.9 7.8-20.7-.1-28.5z" /></svg>
          </button></div>
          <div className="product-cell price">Actions<button className="sort-button">
            <svg xmlns="http://www.w3.org/2000/svg" width={16} height={16} viewBox="0 0 512 512"><path fill="currentColor" d="M496.1 138.3L375.7 17.9c-7.9-7.9-20.6-7.9-28.5 0L226.9 138.3c-7.9 7.9-7.9 20.6 0 28.5 7.9 7.9 20.6 7.9 28.5 0l85.7-85.7v352.8c0 11.3 9.1 20.4 20.4 20.4 11.3 0 20.4-9.1 20.4-20.4V81.1l85.7 85.7c7.9 7.9 20.6 7.9 28.5 0 7.9-7.8 7.9-20.6 0-28.5zM287.1 347.2c-7.9-7.9-20.6-7.9-28.5 0l-85.7 85.7V80.1c0-11.3-9.1-20.4-20.4-20.4-11.3 0-20.4 9.1-20.4 20.4v352.8l-85.7-85.7c-7.9-7.9-20.6-7.9-28.5 0-7.9 7.9-7.9 20.6 0 28.5l120.4 120.4c7.9 7.9 20.6 7.9 28.5 0l120.4-120.4c7.8-7.9 7.8-20.7-.1-28.5z" /></svg>
          </button></div>
         
      </div>
    
          {orders
           .filter((order) =>
           searchQuery ? order.order_id.toString().includes(searchQuery) : true
         )
         .filter((order) =>
           // Apply additional filters based on filterOptions
           (!filterOptions.paymentStatus ||
             order.payment_status.toLowerCase().includes(filterOptions.paymentStatus.toLowerCase())) &&
           (!filterOptions.orderStatus ||
             order.products[0].order_status.toLowerCase().includes(filterOptions.orderStatus.toLowerCase()) &&
           // Add more conditions for other filter options
           (minprice && maxprice) && (
            order.total_price_with_shipping >= minprice && order.total_price_with_shipping <= maxprice
           )
         )
         )
          .map((order) => (
            
            <OrderRows order={order} key={order.order_id}  />
          ))
          } 
    </div>
    )
    : <p className='cart-sidebar-loading'> <img src='/images/loadingGIF.gif'  width={"30px"}/></p> 
    : <p className='cart-sidebar-loading'> <img src='/images/loadingGIF.gif'  width={"30px"}/></p> 
    }
  
    
  </div>
  )
}
